<!DOCTYPE html>
<html>
<head lang="en">
   <meta charset="UTF-8">
   <title></title>
   <link href="css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="header">
   <div class="wrapper clearfix">
      <div class="logo">
         <!-- <img src="images/0-12.png"> -->
      </div>
      <div class="serve">
         <div class="dajia">大家关注</div>
         <div class="kehu">客户服务</div>
      </div>
      <div class="buy-btn">
         <a target="_blank" href="test-pay.html"></a>
      </div>
   </div>
</div>
<div class="banner">
   <div id="myCarousel" class="carousel slide">
      <!-- 轮播（Carousel）指标 -->
      <ol class="carousel-indicators">
         <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
         <li data-target="#myCarousel" data-slide-to="1"></li>
         <li data-target="#myCarousel" data-slide-to="2"></li>
      </ol>
      <!-- 轮播（Carousel）项目 -->
      <div class="carousel-inner">
         <div class="item active">
            <div class="buy-btn"><a target="_blank" href="test-pay.html"></a></div>
            <img src="images/pc/1.jpg" alt="First slide">
         </div>
         <div class="item">
            <div class="buy-btn2"><a target="_blank" href="test-pay.html"></a></div>
            <img src="images/pc/2.jpg" alt="Second slide">
         </div>
         <div class="item ">
            <div class="buy-btn"><a target="_blank" href="test-pay.html"></a></div>
            <img src="images/pc/3.jpg" alt="Third slide">
         </div>
      </div>
      <!-- 轮播（Carousel）导航 -->
      <a class="carousel-control left" href="#myCarousel"
         data-slide="prev"></a>
      <a class="carousel-control right" href="#myCarousel"
         data-slide="next"></a>
   </div>
</div>
<div class="middle">
   <div class="box">
      <div class="hd">大家关注</div>
      <div class="bd">
         <ul>
            <li>
               <div class="item">
                  <div class="pic">
                     <img src="images/pc/0-18.jpg">
                  </div>
                  <h4>蔡文胜</h4>
                  <p class="desc"><span>&#60;美图秀秀董事长&#62;</span><br>做自己喜欢的事！</p>
               </div>
            </li>
            <li>
               <div class="item">
                  <div class="pic">
                     <img src="images/pc/0-19.jpg">
                  </div>
                  <h4>李开复</h4>
                  <p class="desc"><span>&#60;创新工场董事长&#62;</span><br>Follow your hart,are you shall change the world!</p>
               </div>
            </li>
            <li>
               <div class="item">
                  <div class="pic">
                     <img src="images/pc/0-20.jpg">
                  </div>
                  <h4>邓锋</h4>
                  <p class="desc"><span>&#60;北极光创投董事长&#62;</span><br>做有意思且有意义的事！</p>
               </div>
            </li>
         </ul>
      </div>
      <div class="line-box"></div>
   </div>
</div>
<div class="footer">
   <div class="wrapper">
      <div class="phone">
         <img src="images/pc/0-21.png">
         <p>咨询电话 ：1-855-786-8899</p>
      </div>
      <div class="footer_bd">
         <div class="pic_box">
            <div class="pic-left">
               <img src="images/pc/0-23.png">
               <div  class="t1">客服在线 </div>
               <p>请给我们留言</p>
            </div>
         </div>
         <div class="border_box">
            <div id="chatBox" class="chat-list">
               <div id="chatList" class="text">
                  <!--<div class="txt1">
                     <p class="desc">用户1101:</p>
                     <p class="time">2015-10-19 15:37</p>
                     <p class="que">在吗?</p>
                  </div>
                  <div class="txt1">
                     <p class="desc1">客服sunny:</p>
                     <p class="time">2015-10-19 15:37</p>
                     <p class="que">亲~在呢，有什么可以帮到你的吗？</p>
                  </div>
                  <div class="txt1">
                     <p class="desc">用户1101:</p>
                     <p class="time">2015-10-19 15:37</p>
                     <p class="que">请问SunTV盒子在哪里可以买到？</p>
                  </div>
                  <div class="txt1">
                     <p class="desc1">客服sunny:</p>
                     <p class="time">2015-10-19 15:37</p>
                     <p class="que">你可以在微信和亚马逊两个方式购买我们的产品，点击页面右上角的"购买产品"即可。</p>
                  </div>
                  <div class="txt1">
                     <p class="desc">用户1101:</p>
                     <p class="time">2015-10-19 15:37</p>
                     <p class="que">哦，好的，谢谢~</p>
                  </div>-->
               </div>
            </div>
            <div class="chat-textarea">
               <div class="txt-wrapper">
                  <textarea class="txt" id="chatTextArea" placeholder="Ctrl+回车可以快速发送消息！"></textarea>
               </div>
               <div id="submitBtn" class="fasong_btn">
                  <a></a>
               </div>
            </div>
         </div>
      </div>
   </div>
</div>
<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/jquery.cookie.js"></script>
<script type="text/javascript" src="js/socket.io.js"></script>
<script type="text/javascript">
   var saleschat;
   var cid,nickname;
   var $chatTextArea = $("#chatTextArea");
   var $submit = $("#submitBtn");
   var $chatList = $("#chatList");
   var $tipCustomer = $("#tipCustomer");
   var ctrl = false;
   $(document).ready(function () {
      getCid();
      socketIO();
      listen();
   });
   function listen(){
      $(window).keydown(function(event){
         switch(event.keyCode) {
            case 13:
               if(ctrl){
                  ctrl = false;
                  speak();
               }
               break;
            case 17:
               ctrl = true;
               break;
            default :
               console.info(event.keyCode);
               break;
         }
      });
      $chatTextArea.keyup(function(){
         ctrl = false;
      });
      $submit.on("click", function () {
         speak();
      })
   }
   function speak(){
      var txt = $chatTextArea.val();
      var html = '';
      if(txt != ""){
         console.info("{code: 'speak', cnt: " + txt + ", style:''}");
         saleschat.send({code: 'speak', cnt: txt, style:""});
         html += '<div class="txt1"><p class="desc">我：</p><p class="time">' + timeUTCFormat() + '</p><p class="que">' + txt + '</p></div>';
         //html += '<li><div class="msg"><h2 class="msg-from">我<span class="release-time">' + timeUTCFormat() + '</span></h2><p class="msg-cnt">' + txt + '</p></div></li>';
         $chatList.append(html);
         $chatTextArea.val("");
      }
   }
   function wellcome() {
      var html = '<div class="txt1"><p class="desc1">客服：</p><p class="time">' + timeUTCFormat() + '</p><p class="que">您好，欢迎光临！请问有什么可以帮到您的？</p></div>';
      //var html = '<li><div class="come-msg msg"><h2 class="msg-from">客服<span class="release-time">' + timeUTCFormat() + '</span></h2><p class="msg-cnt">您好，欢迎光临！请问有什么可以帮到您的？</p></div></li>';
      $chatList.html(html);
   }
   function comeSpeak(data){
      var html = '';
      html += '<div class="txt1"><p class="desc1">' + data.nickname + '：</p><p class="time">' + timeUTCFormat(data.tm) + '</p><p class="que">' + data.cnt + '</p></div>';
      //html += '<li><div class="come-msg msg"><h2 class="msg-from">' + data.nickname + '<span class="release-time">' + timeUTCFormat(data.tm) + '</span></h2><p class="msg-cnt">' + data.cnt + '</p></div></li>';
      $chatList.append(html);
   }
   function timeUTCFormat(time){
      var date;
      if(time == undefined || time == ""){
         date = new Date();
      } else {
         date = new Date(parseInt(time));
      }
      var h = date.getHours ();
      h = h ? (h >= 10 ? h : "0" + h) + ":" : "00:";
      var m = date.getMinutes ();
      m = m ? (m >= 10 ? m : "0" + m ) : "00";
      return h + m;
   }
   function getCid(){
      cid = $.cookie("customer_cid");
      if(cid == undefined){
         var time = new Date().getTime();
         cid = "RDID_" + time;
         $.cookie("customer_cid",cid,{path:"/"});
      }
      nickname = "客户" + cid.slice(14,18);
      $tipCustomer.text(nickname);
   }
   function socketIO(){
      saleschat = io.connect('http://221.228.74.40', {
         reconnection: true,
         reconnectionDelay: 1000,
         reconnectionDelayMax: 3000,
         timeout: 1000,
         mutiplex: false,
         path: '/saleschat/socket.io'
      });
      saleschat.on('connect', function () {
         console.info('client is connected successfully');
         //Step N.5 必须进行CheckIn注册
         console.info("{cid: " + cid + ", code: 'checkIn', nickname: " + nickname + "}");
         saleschat.send ({cid: cid, code: 'checkIn', nickname: nickname});
         wellcome();
      });
      //消息通道其他消息处理
      saleschat.on('reconnect', function (trynum) {
         console.info('client is trying to reconnect,NO.' + trynum);
      });
      saleschat.on('disconnect', function () {
         console.info('client is disconnected exceptionally');
      });
      saleschat.on('error', function (err) {
         console.info('client errors', err);
      });
      saleschat.on ('message', function(msg) {
         switch (msg.code) {
            case 'checkIn_ok':
               //用户CheckIn注册成功
               console.log(msg.code);
               saleschat.send({code: 'history'});
               break;
            case 'speak_ok':
               //用户发音反馈成功
               console.log(msg.code);
               break;
            case 'speak':
               //用户发音反馈成功
               console.log(msg.code,"来消息");
               comeSpeak(msg);
               break;
            case 'broadcast':
               //用户发音反馈成功 群内有人说话广播消息
               break;
            case 'history_ok':
               console.log(msg.code);
               break;
            case 'delspeak':
               //有一条消息被删除
               console.log(msg.code);
               break;
            case 'error':
               //消息异常错误
               console.log(msg.code);
               break;
            default :
               console.log(msg);
               break;
         }
      });
   }
</script>
</body>
</html>